# Garril-UI组件开发思路

<hr/>



## 组件文件目录结构

<hr/>

```css
以button组件为例，其他组件也都差不多
button
	src
		(像form可能有form-item，就在这里开一个components文件夹)
		button.tsx
		button-type.ts
	style
		button-config.scss
		button.scss
		button-base.scss
	test
		button.test.ts
	index.ts
```



## 组件内容案例 ( button )

<hr/>

以button为例子，展示其组件各个文件大致设计

### / src / button.tsx

```tsx
import { defineComponent, toRefs } from 'vue'
import { ButtonProps, buttonProps } from './button-type'

export default defineComponent({
  name: 'GButton',
  props: buttonProps,
  setup(props: ButtonProps, { slots }) {
    const { type, size, disabled, block } = toRefs(props)
    return () => {
      const defaultSlot = slots.default ? slots.default() : '按钮'
      const blockClass = block.value ? 's-btn--block' : ''
      return (
        <button
          disabled={disabled.value}
          class={`s-btn s-btn--${type.value} s-btn--${size.value} ${blockClass}`}
        >
          {defaultSlot}
        </button>
      )
    }
  }
})

```

### / src / button-type.ts

```ts
import { ExtractPropTypes, PropType } from 'vue'

export type IButtonType = 'primary' | 'secondary' | 'text'
export type IButtonSize = 'small' | 'medium' | 'large'

// button中的props定义
export const buttonProps = {
  type: {
    type: String as PropType<IButtonType>,
    default: 'secondary'
  },
  size: {
    type: String as PropType<IButtonSize>,
    default: 'medium'
  },
  disabled: {
    type: Boolean,
    default: false
  },
  block: {
    type: Boolean,
    default: false
  }
}

// 利用值反推出Button属性类型
export type ButtonProps = ExtractPropTypes<typeof buttonProps>
```

### / style / button.scss

```scss
// button.scss
@use './button-config.scss';
@import './button-base.scss';

.s-btn {
  @include button-base;
  // 导入type相关的样式
  @include button-variant(button-config.$type);
  // 导入size相关的样式
  @include button-variant(button-config.$size);
  // 导入hover等伪类
  @include button-variant(button-config.$pseudo, true);
}
```

### / style / button-base.scss

```scss
// button-base.scss
@import '../../style/variable.scss'; // scss变量定义文件 --- 全局style目录下

@mixin button-base {
  // 布局
  @apply inline-flex items-center justify-center;
  // 元素
  @apply border-[1px] border-solid border-transparent
  h-[28px] py-0 px-[20px]
  bg-transparent;
  border-radius: $s-border-radius;

  // 文本属性
  @apply outline-0 leading-normal whitespace-nowrap
    cursor-pointer;

  // 文字样式
  font-size: $s-font-size-md;

  // 其他样式
  transition: background-color $s-animation-duration-slow
      $s-animation-ease-in-out-smooth,
    border-color $s-animation-duration-slow $s-animation-ease-in-out-smooth,
    color $s-animation-duration-slow $s-animation-ease-in-out-smooth;

  // 禁用状态
  &[disabled] {
    @apply cursor-not-allowed;
  }

  &.s-btn--block {
    @apply block w-full;
  }
  &.s-btn--loading {
    // @apply
  }
}

@mixin button-variant($variant, $pseudo: false) {
  @each $key, $value in $variant {
    // 第一层是多态的类型
    &.s-btn--#{$key} {
      @each $item-key, $item-value in $value {
        // 第二层是多态类型下的样式
        @if $pseudo {
          // 如果是伪类就继续第三层
          &:#{$item-key} {
            @each $sub-item-key, $sub-item-value in $item-value {
              // 第三层是伪类的样式
              #{$sub-item-key}: $sub-item-value;
            }
          }
        } @else {
          // 不是伪类就直接设置样式
          #{$item-key}: $item-value;
        }
      }
    }
  }
}
```

### / style / button-config.scss

```scss
// button-config.scss
// 所有不同type按钮自定义样式
@import '../../style/variable.scss';

// 按钮类型的配置
$type: (
  primary: (
    color: $s-light-text,
    background-color: $s-primary
  ),
  secondary: (
    color: $s-text,
    background-color: $s-block,
    border-color: $s-line
  ),
  text: (
    padding: 0,
    color: $s-brand-active
  )
);

// 伪类的配置
$pseudo: (
  primary: (
    hover: (
      background-color: $s-primary-hover
    ),
    focus: (
      background-color: $s-primary-hover
    ),
    active: (
      background-color: $s-primary-active
    ),
    disabled: (
      color: $s-light-text,
      background-color: $s-primary-disabled,
      border: none
    )
  ),
  secondary: (
    hover: (
      border-color: $s-form-control-line-active,
      color: $s-brand-active
    ),
    focus: (
      border-color: $s-form-control-line-active,
      color: $s-brand-active
    ),
    active: (
      border-color: $s-form-control-line-active,
      color: $s-brand-active
    ),
    disabled: (
      color: $s-disabled-text,
      background-color: $s-disabled-bg,
      border: 1px solid $s-disabled-line
    )
  ),
  text: (
    hover: (
      color: $s-brand-active-focus
    ),
    focus: (
      color: $s-brand-active-focus
    ),
    active: (
      color: $s-brand-active-focus
    ),
    disabled: (
      color: $s-disabled-text
    )
  )
);

// 按钮尺寸
$size: (
  small: (
    height: 24px,
    padding: 0 16px,
    font-size: $s-font-size-sm
  ),
  medium: (
    font-size: $s-font-size-md
  ),
  large: (
    height: 32px,
    padding: 0 24px,
    font-size: $s-font-size-lg
  )
);
```

### / test /  button.test.ts

```ts
import { render } from '@testing-library/vue'
import Button from '../src/button'

// base button
test('test base button,without anything passed', () => {
  const { getByRole } = render(Button)
  getByRole('button')
})
// type
// button type defalut should be secondary
test('test button default type', () => {
  const { getByRole } = render(Button)
  const button = getByRole('button')
  expect(button.classList.contains('s-btn--secondary')).toBe(true)
})
// test button pass props type
test('test button pass props type', () => {
  const { getByRole } = render(Button, {
    props: {
      type: 'primary'
    }
  })
  const button = getByRole('button')
  expect(button.classList.contains('s-btn--primary')).toBe(true)
})

// slot
// slot default should be right
test('test slot default should be right', () => {
  const { getByText } = render(Button)
  getByText('按钮')
})
// slot should work
test('slot should work', () => {
  const { getByText } = render(Button, {
    slots: {
      default() {
        return 'inslot'
      }
    }
  })
  getByText('inslot')
})

```

###  / index.ts

```ts
import { App } from 'vue'

import Button from './src/button'

// 具名导出
export { Button }

// 导出插件
export default {
  install(app: App) {
    app.component(Button.name, Button)
  }
}
```



## 整体的scss

### 安装tailwind

```scss
npm install -D tailwindcss
npx tailwindcss init
```

修改根目录下的`tailwind.config.js`文件

```js
/** @type {import('tailwindcss').Config} */
module.exports = {
  // Add the paths to all of your template files in your tailwind.config.js file.
  content: ['./public/index.html', './src/**/*.{vue,js,ts,jsx,tsx}'],
  theme: {
    extend: {}
  },
  plugins: []
}
```

Add the Tailwind directives to your CSS。在根路径的 index.scss中（main.ts对index.scss做引入）

```scss
// @import "tailwindcss/base";
// @import "tailwindcss/components";
// @import "tailwindcss/utilities";
@tailwind base;
@tailwind components;
@tailwind utilities;
```



### $变量

在整个项目的`src/style/variable.scss`下

```scss
// 变量
$prefix: 's';
$spacing-3: 6px;
// 定义主题变量
$s-border-radius: var(--s-border-radius, 2px); //一般圆角
$s-font-size-sm: var(--s-font-size-md, 10px); //当组件size为''时使用此字号大小
// 使用变量
$size-mini: $size-6;
// 线性
$transition-timing-function-linear: cubic-bezier(0, 0, 1, 1);
```

用以上的方法定义了很多的变量，之后在其他的scss文件中可以引入，使用变量：

```scss
@import '../../style/variable.scss';
xxx {
  border-radius: $s-border-radius;
}
```

### mixin 

**用`mixin`定义样式块 `button-base ` ( 配合了 `tailwindcss `)**

```scss
@import '../../style/variable.scss';
@mixin button-base {
  // 布局
  @apply inline-flex items-center justify-center;
  // 元素
  @apply border-[1px] border-solid border-transparent
  h-[28px] py-0 px-[20px]
  bg-transparent;
  border-radius: $s-border-radius;

  // 文本属性
  @apply outline-0 leading-normal whitespace-nowrap
    cursor-pointer;

  // 文字样式
  font-size: $s-font-size-md;

  // 其他样式
  transition: background-color $s-animation-duration-slow
      $s-animation-ease-in-out-smooth,
    border-color $s-animation-duration-slow $s-animation-ease-in-out-smooth,
    color $s-animation-duration-slow $s-animation-ease-in-out-smooth;

  // 禁用状态
  &[disabled] {
    @apply cursor-not-allowed;
  }

  &.s-btn--block {
    @apply block w-full;
  }
  &.s-btn--loading {
    // @apply
  }
}
```

使用`button-base`

```scss
@import './button-base.scss';
.s-btn {
  @include button-base;
}
```

**用mixin定义函数**

```scss
@import '../../style/variable.scss';
@mixin button-variant($variant, $pseudo: false) {
  @each $key, $value in $variant {
    // 第一层是多态的类型
    &.s-btn--#{$key} {
      @each $item-key, $item-value in $value {
        // 第二层是多态类型下的样式
        @if $pseudo {
          // 如果是伪类就继续第三层
          &:#{$item-key} {
            @each $sub-item-key, $sub-item-value in $item-value {
              // 第三层是伪类的样式
              #{$sub-item-key}: $sub-item-value;
            }
          }
        } @else {
          // 不是伪类就直接设置样式
          #{$item-key}: $item-value;
        }
      }
    }
  }
}
```

使用 `button-variant`  函数

```scss
@use './button-config.scss';
@import './button-base.scss';

.s-btn {
  // 导入type相关的样式
  @include button-variant(button-config.$type);
  // 导入size相关的样式
  @include button-variant(button-config.$size);
  // 导入hover等伪类
  @include button-variant(button-config.$pseudo, true);
}
// 文件名如果不以下划线开头的话，sass会认为改文件是一个应用文件，不会将它转成css文件
//  @import "_main.css";
```

可以看到，这里面还有个`@use`和`button-config`变量

### @use

```scss
// 所有不同type按钮自定义样式
@import '../../style/variable.scss';
// 按钮类型的配置
$type: (
  primary: (
    color: $s-light-text,
    background-color: $s-primary
  ),
  secondary: (
    color: $s-text,
    background-color: $s-block,
    border-color: $s-line
  ),
  text: (
    padding: 0,
    color: $s-brand-active
  )
);
// 伪类配置
$pseudo: (
  primary: (
    hover: (
      background-color: $s-primary-hover
    ),
    focus: (
      background-color: $s-primary-hover
    ),
    active: (
      background-color: $s-primary-active
    ),
    disabled: (
      color: $s-light-text,
      background-color: $s-primary-disabled,
      border: none
    )
  ),
  secondary: (...),
  text: (...)
)
// 按钮尺寸
$size: (
  small: (
    height: 24px,
    padding: 0 16px,
    font-size: $s-font-size-sm
  ),
  medium: (...),
  large: (...)
);
```



## button

### props

首先 button 有 三种类型：

```ts
'primary' | 'secondary' | 'text'

export type IButtonType = 'primary' | 'secondary' | 'text'
type: {
  type: String as PropType<IButtonType>,
  default: 'secondary'
},
```

三种 大小 size：

```css
'small' | 'medium' | 'large'
```

能够控制，是否接收被点击：

```ts
disabled: {
  type: Boolean,
  default: false
}
```

如果是手机端，需要按钮够长，为一个 block

```ts
block: {
  type: Boolean,
  default: false
}
```

### code

```css
toRefs(props) 解构下，再把拿到的属性，根据逻辑需要，在tsx中处理
没有其他事件处理，没监听没emit
button按钮中显示的文字做个slot，其他无
```



## input





## modal



## form



## pagination



## tree



## virtual-list























